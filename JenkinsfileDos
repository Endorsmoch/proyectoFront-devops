pipeline {
    agent any

    parameters {
        string(name: 'BUILD_NUMBER', defaultValue: '', description: 'Número de versión')
        string(name: 'DIST_PATH', defaultValue: '', description: 'Ruta del directorio dist')
    }

    stages {
        //  stage('Copy Artifact') {
        //     steps {
        //         bat('echo %cd%')
        //         bat('dir')
        //         bat("echo ${env.DIST_PATH}")
        //         copyArtifacts(projectName: 'FrontendStorePipeline1', filter: "${env.DIST_PATH}", fingerprintArtifacts: true)
        //     }
        // }
        stage('Conexión SSH y transferencia de archivos') {
            steps {
                script {
                    // Dirección IP de la máquina virtual
                    def vmIP = '192.168.0.26'
                    // Nombre de usuario para la conexión SSH
                    def sshUser = 'ubuntu'
                    // Contraseña para la conexión SSH
                    def sshPassword = 'ubuntu'

                    // Comando para ejecutar en la máquina virtual
                    
                    // Ruta completa al archivo pscp.exe con barra invertida duplicada
                    def pscpPath = 'C:/pscp.exe'

                    bat('echo %cd%')
                    bat('dir')
                    // Comando para establecer la conexión SSH y ejecutar los comandos
                    def sshCommandFull = "${pscpPath} -pw ${sshPassword} -r ${env.DIST_PATH} ${sshUser}@${vmIP}:../../var/www/html/devops_web/"

                    bat(sshCommandFull)
                }
            }
        }
    }

    post {
        success {
            echo '¡El segundo pipeline se ha completado exitosamente!'
        }
        failure {
            echo 'El segundo pipeline ha fallado!'
        }
    }
}
