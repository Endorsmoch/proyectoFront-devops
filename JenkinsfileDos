pipeline {
  agent any

  stages {
    stage('Conexión SSH y comandos en la máquina virtual') {
      steps {
        script {
          // Dirección IP de la máquina virtual
          def vmIP = '192.168.0.26'
          // Nombre de usuario para la conexión SSH
          def sshUser = 'ubuntu'
          // Contraseña para la conexión SSH
          def sshPassword = 'ubuntu'

          // Comando para ejecutar en la máquina virtual
          def sshCommand = 'sudo -u ubuntu git -C /var/www/html pull origin devops/Front-23'

          // Ruta completa al archivo plink.exe
          def plinkPath = 'C:/plink.exe'

          // Huella digital del servidor SSH
          def hostKey = 'ssh-ed25519 255 SHA256:V4rGl41cT7XvnrAFEE+wPLvrONJp6uCabSN1oBFVtdc'

          // Comando para establecer la conexión SSH y ejecutar los comandos, incluyendo la opción -hostkey y el usuario especificado
          def sshCommandFull = "${plinkPath} -ssh ${sshUser}@${vmIP} -pw ${sshPassword} -hostkey \"${hostKey}\" -batch -t \"${sshCommand}\""

          bat(sshCommandFull)
        }
      }
    }
  }
}
